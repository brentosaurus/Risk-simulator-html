<!DOCTYPE html>
<html>
<head>
<title>Brent's Risk Simulator</title>
</head>
<body>
<h1>Brent's Risk Simulator</h1>

<div>
	Attacker armies
		<input type="range" min="2" max="100" value="5" class="slider" id="attackers">
		<label for="attackers" id="attackersLabel"></label>
	<p/>
	Defender armies
		<input type="range" min="1" max="100" value="5" class="slider" id="defenders">
		<label for="defenders" id="defendersLabel"></label>
	<p/>
	Runs
		<input type="range" min="3" max="1000" value="3" class="slider" id="runs">
		<label for="runs" id="runsLabel"></label>
	<p/>
	<div id="result"></div>
</div>

<script>
//----------------------------------------------------------------------
function dice() {
	const minimum = 1
	const maximum = 6
	return Math.floor(Math.random() * (maximum - minimum + 1)) + minimum
}

function combat(attacker, defender) {
	console.log('------>', attacker, defender)
	for (;;) {
		//--- combat ends if attacker has 1 army or defender has 0 armies
		if (attacker <= 1)
			return true
		if (defender <= 0)
			return false

		//--- throw dice, sort by largest first
		a = Array(Math.min(attacker, 3)).fill().map(() => dice())
		d = Array(Math.min(attacker, 2)).fill().map(() => dice())
		a = a.sort((i, j) => j - i)
		d = d.sort((i, j) => j - i)
		console.log('attacker dice', a)
		console.log('defender dice', d)
		
		//--- remove armies based on dice
		if (a[0] > d[0])
			defender--
		else
			attacker--

		if (a.size >= 2 && d.size >= 2) {
			if (a[1] > d[1])
				defender--
			else
				attacker--
		}
	}
}

//----------------------------------------------------------------------
function multipleCombat(attacker, defender, runs) {
	console.log('--- multipleCombat', attacker, defender, runs)
	let attackerWins = 0
	for (let i = 0; i < runs; i++) {
		console.log('run', i)
		attackerWins += combat(attacker, defender)
	}
	return "Attacker wins " + Math.round(100 * attackerWins / runs)
}

//----------------------------------------------------------------------
function updateAll() {
	const attackers = document.getElementById("attackers")
	const defenders = document.getElementById("defenders")
	const runs = document.getElementById("runs")
	console.log('attackers value', attackers.value)

	document.getElementById("attackersLabel").innerHTML = attackers.value
	document.getElementById("defendersLabel").innerHTML = defenders.value
	document.getElementById("runsLabel").innerHTML = runs.value

	document.getElementById("result").innerHTML = multipleCombat(attackers.value, defenders.value, runs.value)
}
document.getElementById("attackers").oninput = updateAll
document.getElementById("defenders").oninput = updateAll
document.getElementById("runs").oninput = updateAll

updateAll()

//----------------------------------------------------------------------
</script>

</body>
</html>