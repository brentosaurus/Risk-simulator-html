<!DOCTYPE html>
<html>
<head>
<title>Brent's Risk Simulator</title>
</head>
<style>
	body {
		font-family:sans-serif;
	}
</style>
<body>
<h1>Brent's Risk Simulator</h1>

<div>
	<span style="width:1.5in; display:inline-block">Attacker armies</span>
		<input type="range" min="2" max="50" value="5" class="slider" style="width:250px" id="attackers">
		<label for="attackers" id="attackersLabel"></label>
	<p/>
	<span style="width:1.5in; display:inline-block">Defender armies</span>
		<input type="range" min="1" max="50" value="5" class="slider" style="width:250px" id="defenders">
		<label for="defenders" id="defendersLabel"></label>
	<p/>
	<span style="width:1.5in; display:inline-block">Runs</span>
		<input type="range" min="50" max="1000" value="250" class="slider" id="runs">
		<label for="runs" id="runsLabel"></label>
	<p/>
	<div id="result" style="font-weight:bold"></div>
</div>

<script>
//----------------------------------------------------------------------
function dice() {
	const minimum = 1
	const maximum = 6
	return Math.floor(Math.random() * (maximum - minimum + 1)) + minimum
}

function combat(attacker, defender) {
	for (;;) {
		//--- combat ends if attacker has 1 army or defender has 0 armies
		if (attacker <= 1)
			return false
		if (defender <= 0)
			return true

		//--- throw dice, sort by largest first
		a = Array(Math.min(attacker, 3)).fill().map(() => dice())
		d = Array(Math.min(attacker, 2)).fill().map(() => dice())
		a = a.sort((i, j) => j - i)
		d = d.sort((i, j) => j - i)
		
		//--- remove armies based on dice
		if (a[0] > d[0])
			defender--
		else
			attacker--

		if (a.length >= 2 && d.length >= 2) {
			if (a[1] > d[1])
				defender--
			else
				attacker--
		}
	}
}

//----------------------------------------------------------------------
function multipleCombat(attacker, defender, runs) {
	let attackerWins = 0
	for (let i = 0; i < runs; i++) {
		j = combat(attacker, defender)
		attackerWins += j
	}
	return "Attacker wins " + Math.round(100 * attackerWins / runs) + '%'
}

//----------------------------------------------------------------------
function updateAll() {
	const attackers = document.getElementById("attackers")
	const defenders = document.getElementById("defenders")
	const runs = document.getElementById("runs")

	document.getElementById("attackersLabel").innerHTML = attackers.value
	document.getElementById("defendersLabel").innerHTML = defenders.value
	document.getElementById("runsLabel").innerHTML = runs.value

	document.getElementById("result").innerHTML = multipleCombat(attackers.value, defenders.value, runs.value)
}
document.getElementById("attackers").oninput = updateAll
document.getElementById("defenders").oninput = updateAll
document.getElementById("runs").oninput = updateAll

updateAll()

//----------------------------------------------------------------------
</script>

</body>
</html>